# LV1: 시장을 읽는 관찰자 (The Observer) 개발 계획

**전체 목표**: 내 계좌의 현재 상태와 보유 종목에 대한 최신 뉴스를 요약하여 보고받는 시스템 구축

**핵심 기능**: 데이터 수집 및 요약 (순차적 흐름)

**LangGraph 구조**:
- **노드**: `계좌 상태 조회` → `뉴스 수집` → `결과 요약 및 보고`
- **엣지**: 단일 직선적 흐름
- **상태**: `portfolio_status`, `news_data`, `daily_report`

---

## Phase 1: 환경 설정 및 기초 구조

### 1.1 개발 환경 구성
- [x] Python 가상환경 생성 및 활성화
- [x] requirements.txt 작성
- [x] LangGraph, LangChain 핵심 패키지 설치
- [x] 추가 필요 패키지 설치 (requests, python-dotenv, pandas)

### 1.2 프로젝트 구조 생성
- [x] 프로젝트 디렉토리 구조 설계
- [x] `src/` 디렉토리 생성 (메인 코드)
- [x] `config/` 디렉토리 생성 (설정 파일)
- [x] `tests/` 디렉토리 생성 (테스트 코드)
- [x] `logs/` 디렉토리 생성 (로그 파일)

### 1.3 기본 설정 파일 작성
- [x] `.env` 파일 생성 (API 키 등 환경변수)
- [x] `config/settings.py` 작성 (기본 설정)
- [x] `.gitignore` 업데이트 (환경변수, 로그 파일 제외)

### 1.4 API 연동 준비
- [x] 한국투자증권 KIS API 계정 생성 (또는 모의투자) - 설정 가이드 작성
- [x] API 키 발급 및 환경변수 설정 - .env 템플릿 작성
- [x] 뉴스 API 선택 및 설정 (네이버 뉴스 API 등) - 설정 가이드 작성
- [x] API 연결 테스트 - 테스트 스크립트 작성

---

## Phase 2: LangGraph 기본 구조 설계

### 2.1 State 스키마 정의
- [x] `State` 클래스 정의 (TypedDict 활용)
- [x] `portfolio_status` 필드 설계 (종목코드, 수량, 평가금액 등)
- [x] `news_data` 필드 설계 (종목별 뉴스 리스트)
- [x] `daily_report` 필드 설계 (최종 브리핑 내용)
- [x] 기타 메타데이터 필드 추가 (timestamp, status 등)

### 2.2 기본 그래프 틀 생성
- [x] `StateGraph` 객체 생성
- [x] 세 개의 기본 노드 정의 (함수 스텁)
- [x] 노드 간 엣지 연결 설정
- [x] 그래프 컴파일 및 기본 실행 테스트

### 2.3 에러 핸들링 구조 설계
- [x] 각 노드별 예외 처리 전략 수립
- [x] 로깅 시스템 설계 (logging 모듈 활용)
- [x] API 호출 실패 시 재시도 로직 설계
- [x] 그래프 실행 중단 시 복구 방안 설계

---

## Phase 3: 계좌 상태 조회 노드 구현

### 3.1 증권사 API 연결 함수 작성
- [ ] KIS API 인증 토큰 발급 함수 구현
- [ ] API 호출 기본 함수 구현 (헤더, 인증 포함)
- [ ] 연결 상태 확인 함수 구현
- [ ] API 제한 및 쿨다운 처리 로직

### 3.2 포트폴리오 정보 조회 로직 구현
- [ ] 계좌 잔고 조회 API 호출 함수
- [ ] 보유 종목 리스트 조회 함수
- [ ] 종목별 현재가, 평가손익 조회 함수
- [ ] 총 자산, 투자금, 수익률 계산 로직

### 3.3 데이터 파싱 및 정제
- [ ] API 응답 JSON 파싱 로직
- [ ] 필요한 데이터만 추출하는 필터링 함수
- [ ] 데이터 타입 변환 및 검증 로직
- [ ] 누락된 데이터 처리 방안

### 3.4 State 업데이트 및 테스트
- [ ] `portfolio_status`에 조회 결과 저장 로직
- [ ] 노드 함수 완성 (`fetch_portfolio_status`)
- [ ] 단위 테스트 작성 및 실행
- [ ] 목업 데이터를 활용한 테스트

---

## Phase 4: 뉴스 수집 노드 구현

### 4.1 뉴스 API 연결
- [ ] 네이버 뉴스 검색 API 연동 함수 구현
- [ ] 다음 뉴스 API 또는 대체 뉴스 소스 연동
- [ ] 뉴스 검색 쿼리 최적화 (종목명, 종목코드 활용)
- [ ] API 호출 제한 및 지연 처리

### 4.2 보유 종목별 뉴스 검색
- [ ] 종목 리스트를 순회하며 뉴스 검색하는 로직
- [ ] 종목명을 활용한 검색 키워드 생성
- [ ] 검색 결과 중복 제거 로직
- [ ] 뉴스 발행 시간 필터링 (최근 24시간 등)

### 4.3 뉴스 데이터 처리 및 정제
- [ ] 뉴스 제목, 요약, 링크 추출
- [ ] 관련도 점수 계산 (종목명 언급 빈도 등)
- [ ] 긍정/부정 뉴스 간단 분류
- [ ] 중요도별 뉴스 정렬

### 4.4 State 업데이트 및 테스트
- [ ] `news_data`에 수집 결과 저장 로직
- [ ] 노드 함수 완성 (`collect_news_data`)
- [ ] 단위 테스트 작성 및 실행
- [ ] 다양한 종목에 대한 뉴스 수집 테스트

---

## Phase 5: 결과 요약 및 보고 노드 구현

### 5.1 LLM 활용 분석 프롬프트 작성
- [ ] 포트폴리오 분석을 위한 프롬프트 템플릿 작성
- [ ] 뉴스 요약을 위한 프롬프트 템플릿 작성
- [ ] 투자 관점에서의 종합 분석 프롬프트 작성
- [ ] 프롬프트 버전 관리 및 테스트

### 5.2 뉴스 요약 및 영향도 분석
- [ ] LangChain을 활용한 LLM 연동 (OpenAI GPT 또는 대안)
- [ ] 종목별 뉴스 요약 생성 함수
- [ ] 뉴스의 주가 영향도 분석 로직
- [ ] 전체 포트폴리오에 대한 뉴스 영향 종합

### 5.3 일일 브리핑 리포트 생성
- [ ] 포트폴리오 현황 요약 섹션
- [ ] 주요 뉴스 및 영향도 분석 섹션
- [ ] 주의사항 및 모니터링 포인트 섹션
- [ ] 리포트 템플릿 및 포맷 디자인

### 5.4 결과 출력 및 저장
- [ ] 콘솔 출력용 포맷팅 함수
- [ ] 파일 저장 기능 (일자별 리포트 저장)
- [ ] 이메일 발송 기능 (선택사항)
- [ ] 리포트 히스토리 관리

### 5.5 노드 완성 및 테스트
- [ ] `generate_daily_report` 노드 함수 완성
- [ ] 다양한 시나리오에 대한 테스트
- [ ] 리포트 품질 검증 및 개선

---

## Phase 6: 전체 그래프 연결 및 테스트

### 6.1 그래프 통합 및 연결
- [ ] 세 개 노드를 순차적으로 연결
- [ ] 노드 간 데이터 전달 검증
- [ ] State 객체 흐름 최종 점검
- [ ] 그래프 실행 시간 측정 및 최적화

### 6.2 통합 테스트 수행
- [ ] 전체 워크플로우 end-to-end 테스트
- [ ] 다양한 포트폴리오 상황에 대한 테스트
- [ ] 뉴스가 없는 경우, API 오류 등 예외 상황 테스트
- [ ] 성능 테스트 및 병목 구간 식별

### 6.3 에러 처리 및 로깅 강화
- [ ] 각 노드별 상세 로깅 추가
- [ ] 에러 발생 시 적절한 메시지 및 복구 로직
- [ ] 그래프 실행 상태 모니터링 기능
- [ ] 디버깅을 위한 중간 결과 저장 기능

### 6.4 사용자 인터페이스 및 문서화
- [ ] 명령행 인터페이스 (CLI) 구현
- [ ] 설정 파일을 통한 사용자 커스터마이징
- [ ] 사용법 가이드 문서 작성
- [ ] 코드 주석 및 docstring 보완

### 6.5 배포 준비 및 최종 검증
- [ ] 실제 계좌 (또는 모의투자)에서 최종 테스트
- [ ] 일일 자동 실행을 위한 스케줄링 설정 (cron 등)
- [ ] 보안 점검 (API 키 보호, 로그 민감정보 제거)
- [ ] 버전 1.0 릴리스 준비

---

## 추가 고려사항

### 보안 및 안정성
- [ ] API 키 암호화 저장
- [ ] 네트워크 오류 시 재시도 로직
- [ ] 과도한 API 호출 방지 (rate limiting)

### 확장성 대비
- [ ] 설정 파일을 통한 종목 추가/제거 기능
- [ ] 다른 증권사 API로의 확장 가능성 고려
- [ ] 뉴스 소스 다변화 준비

### 사용자 경험
- [ ] 진행 상황 표시 (progress bar)
- [ ] 실행 시간 단축을 위한 최적화
- [ ] 직관적인 리포트 형식 및 가독성 개선